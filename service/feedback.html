<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>用户反馈</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

		<!-- 修改1：把href里的路径换成自己的 -->
		<link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">
		 
		<style>
			/* 为带有require类的元素添加红色星号前缀 */
			.required::before {
				/* 星号内容 */
				content: "*";
					/* 红色 */
				color: #ff0000;
				/* 与文字保持一点距离 */
				margin-right: 4px;
			/* 星号加粗 */
				font-weight: bold;				
			}
		</style>
	</head>
	<body>
		<!-- 网页标题，这里用fieldset来设置 -->
		<fieldset class="layui-elem-field layui-field-title">
			<!-- 修改2：把“添加用户”换成自己的 -->
			<legend style="font-weight: bold;">用户反馈</legend>
		</fieldset>

		<!-- 表单开始，表单要加上样式class="layui-form" -->
		<div class="layui-form">
			
		<div class="layui-form-item">
		  <label class="layui-form-label required">反馈类型</label>
		  <div class="layui-input-block">
			<select id="feedbackTypeFilter" name="feedbackType" lay-filter="feedbackTypeFilter" lay-verify="required">
			  <option value="1">建议</option>
			  <option value="2">投诉</option>
			  <option value="3">bug</option>
			</select>
		  </div>
		</div>	
			
			<div class="layui-form-item">
				<label class="layui-form-label">投诉</label>
				<div class="layui-input-block">
					<textarea id="complaintText" name="complaint" class="layui-textarea" placeholder="为匿名投诉，请您认真反映问题！"></textarea>
				</div>
			</div>
			
			<!-- 用户名表单项开始，表单项要加上样式class="layui-form-item" -->
			<div class="layui-form-item">
				<label class="layui-form-label required">建议</label>
				<div class="layui-input-block">
					<textarea id="username" type="text" name="username" class="layui-textarea" lay-verify="required"
						lay-reqtext="请输入您宝贵的建议"  placeholder="请输入您宝贵的建议"></textarea>
				</div>
			</div>
			
			<div class="layui-form-item">
				<label class="layui-form-label required">评价的律师</label>
				<div class="layui-input-block">
					<select lay-verify="required">
						<option value="1">王小强</option>
						<option value="2">张凯迪</option>
						<option value="3">刘侯丹</option>
					</select>
				</div>
			</div>
			
			<div id="ID-rate-demo-text" style="margin-left:100px;"></div>

			<!-- 提交按钮 -->
			<div style="margin-top: 50px;" class="layui-form-item">
				<div class="layui-input-block">
					<button class="layui-btn layui-btn-normal" lay-submit lay-filter="saveBtn">确认提交</button>
				</div>
			</div><!-- 提交按钮结束 -->

		</div>
		<!--表单结束-->

		<!-- 修改3：把路径换成自己的 -->
		<script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
		<script>
			
			layui.use(['form', 'rate', 'layer'], function() {
			  var form = layui.form;
			  var layer = layui.layer;
			  var $ = layui.$;
			  var rate = layui.rate;

			  // 渲染评分组件
			  rate.render({
				elem: '#ID-rate-demo-text',
				value: 2,
				text: true
			  });

			  // 监听“反馈类型”下拉选择变化
			  form.on('select(feedbackTypeFilter)', function(data) {
				var selectedValue = data.value;
				var $complaintItem = $('#complaintText').parents('.layui-form-item');
				var $suggestionItem = $('#username').parents('.layui-form-item');
				var $complaintText = $('#complaintText');
				var $suggestionText = $('#username');

				if (selectedValue === '2') { 
				  $complaintText.attr({
					'lay-verify': 'required',
					'lay-reqtext': '请输入投诉内容'
				  });
				  $complaintItem.find('label').addClass('required');

				  $suggestionText.removeAttr('lay-verify lay-reqtext');
				  $suggestionItem.find('label').removeClass('required');
				} else if (selectedValue === '1') { 
				  $suggestionText.attr({
					'lay-verify': 'required',
					'lay-reqtext': '请输入您宝贵的建议'
				  });
				  $suggestionItem.find('label').addClass('required');

				  $complaintText.removeAttr('lay-verify lay-reqtext');
				  $complaintItem.find('label').removeClass('required');
				} else { 
				  $complaintText.removeAttr('lay-verify lay-reqtext');
				  $complaintItem.find('label').removeClass('required');

				  $suggestionText.removeAttr('lay-verify lay-reqtext');
				  $suggestionItem.find('label').removeClass('required');
				}

				form.render(); 
			  });

			  // 页面初始化：渲染 select + 手动触发“建议”选中的 change 事件
			  form.render('select'); 
			  $('#feedbackTypeFilter').val('1').change(); 

			  // 监听表单提交
			  form.on('submit(saveBtn)', function(data) {
				layer.alert(JSON.stringify(data.field), {
				  title: '最终的提交信息'
				}, function() {
				  layer.closeAll();
				  var iframeIndex = parent.layer.getFrameIndex(window.name);
				  parent.layer.close(iframeIndex);
				});
				return false;
			  });
			});
			

		</script>
	</body>
</html>
